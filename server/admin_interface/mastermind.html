
<content><center>

<?comment calculate the answer ?>
<if not="1" variable="form.turn">
  <for from="1" to="6">
    <set variable="var.c"><random separator="">012345</random></set>
    <append variable="form.q" from="var.c"/>
  </for>
  <set variable="form.q" expr="&form.q; ^ 1745381"/>
  <set variable="form.turn" value="0" />
</if>
<else>
  <for variable="var.i" from="1" to="&form.turn;">
    <set variable="var.r"><insert variable="form.or&var.i;"/></set>
    <append variable="var.or" value="&amp;or&var.i;=&var.r;"/>
  </for>
</else>

<set variable="var.q" expr="&form.q; ^ 1745381"/>

<script language="JavaScript">

turn = &form.turn;;
old = "&var.or:none;";
quest = "&form.q;";

buggy_image_counter = false;
if (navigator.appName == "Microsoft Internet Explorer") buggy_image_counter = true;

function tomArrej() {
  for(var i = 0; i < 7; i++)
    this[i] = 0;
}

arrej = new tomArrej();
colors = new tomArrej();
colors[0] = "grey";
colors[1] = "blue";
colors[2] = "green";
colors[3] = "yellow";
colors[4] = "purple";
colors[5] = "red";

function shiftColor(imgName) {
  if(buggy_image_counter) imgName--;
  arrej[imgName] = (arrej[imgName]+1)%6;
  document [imgName].src = "/*/pixel-" + colors[arrej[imgName]];
}

function send() {
  var ret="";
  turn++;
  for(var i = 1; i < 7; i++)
    ret+=arrej[i];
  top.location="mastermind.html?turn="+turn+"&or"+turn+"="+ret+old+"&q="+quest;
}

</script>

<table border="0" bgcolor="&usr.content-bg;" cellspacing="0" cellpadding="4" width="500">
<tr><td colspan="3"><gtext href="&page.self;" font="yikes!" hspace="20" vspace="4" fontsize="24">Mastermind</gtext></td></tr>
<tr valign="bottom" align="right" ><td>Make your guess <imgs src="&usr.next;"/></td><td align="center">
<table border="0" cellspacing="0" cellpadding="1">
<tr><td></td><td></td><td></td><td></td><td></td><td></td> <td width="10"></td> <td></tr></tr>

<?comment draw the previous guesses ?>
<if variable="form.turn > 0">
<define tag="square"><td><img src="/*/pixel-&_.color;" width="20" height="20" border="0" /></td></define>
<set variable="var.qs" split="">&var.q;</set>
<for variable="var.i" from="1" to="&form.turn;">
  <tr>
  <set variable="var.r"><insert variable="form.or&var.i;"/></set>
  <set variable="var.gold" value="0"/>
  <set variable="var.silver" value="0"/>
  <set variable="var.i" value="0"/>
  <unset variable="var.tmp"/>
  <emit source="values" values="&var.r;" advanced="chars">
    <inc variable="var.i"/>
    <cond>
      <case variable="value = 0"><square color="grey"/></case>
      <case variable="value = 1"><square color="blue"/></case>
      <case variable="value = 2"><square color="green"/></case>
      <case variable="value = 3"><square color="yellow"/></case>
      <case variable="value = 4"><square color="purple"/></case>
      <case variable="value = 5"><square color="red"/></case>
    </cond>
    <set variable="var.c"><insert variable="var.qs.&var.i;"/></set>
    <if variable="value = &var.c;"><inc variable="var.gold"/><append variable="var.tmp" value="x"></if>
    <else><append variable="var.tmp" value="&var.c;"/></else>
  </emit>
  <emit source="values" values="&var.r;" advanced="chars">
    <if variable="var.tmp = *&_.value;*">
      <inc variable="var.silver"/>
    </if>
  </emit>
  <td></td>
  <td><font style="font-size: 4px">
    <for variable="var.j" from="1" to="&var.gold;">
      <img src="/*/pixel-green" width="5" height="5" hspace="1" vspace="1" border="1"/>
    </for><br />
    <for variable="var.j" from="1" to="&var.silver;">
      <img src="/*/pixel-yellow" width="5" height="5" hspace="1" vspace="1" border="1"/>
    </for>
  </font></td></tr>
</for>
</if>

<?comment draw the interface ?>
<if variable="form.turn > 0"><set variable="var.r"><insert variable="form.or&form.turn;"/></set></if>
<if variable="var.q = &var.r;">
  <tr><td colspan="6" align="center"><b>That's right!</b></td></tr>
  <set variable="var.win">1</set>
</if>
<else>
<tr><for variable="var.i" from="1" to="6">
  <td><a href="javascript:shiftColor(&var.i;)">
  <img src="/*/pixel-grey" width="20" height="20" border="0" name="&var.i;" /></a></td>
</for><td></td><td>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;</td></tr>
</else>

</table></td>
<td align="left"><if not="1" variable="var.win = 1"><gbutton href="javascript:send()">Done</gbutton></if></td>
</tr>
<tr><td colspan="3" align="center">
<table width="400"><tr><td>
<if not="1" prestate="!help">
<font size="-1"><p>The goal with mastermind is to figure out the colors the computer has choosen. The
computer chooses one color out of grey, blue, green, yellow, purple and red for every of the six positions
represented by the squares above. In total this gives 46656 possible combinations. You enter your guess by
clicking the squares until the represent your guess and press the Done button.</p>
<p>The computer will compare your guess with its choosen colors and will score your guess. You'll get one green marker
for every square that has the right color. You'll also be awared one yellow marker for every right color that is in the
wrong square.</p></font>
<apre add="!help"><gbutton>Hide help</gbutton></a>
</if><else>
<apre drop="!help"><gbutton>Show help</gbutton></a>
</else>
</td></tr></table>
</table>

</center></content>