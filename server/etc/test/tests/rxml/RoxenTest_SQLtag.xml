<use-module>sqltag</use-module>

<test>
<rxml><sqlquery db="local" query="CREATE TABLE __test (id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
a VARCHAR(255))"/>&page.last-true;</rxml>
<result>1</result>
</test>

<test>
<rxml><sqlquery db="local" query="INSERT INTO __test (a) VALUES ('hej')"/>&page.last-true;</rxml>
<result>1</result>
</test>

<test>
<rxml><sqlquery db="local" mysql-insert-id="var.id"
 query="INSERT INTO __test (a) VALUES ('hopp')"/>&page.last-true;:&var.id;</rxml>
<result>1:2</result>
</test>

<test>
<rxml><sqlquery db="local" query="INSERT INTO __test (a) VALUES (NULL)"/>&page.last-true;</rxml>
<result>1</result>
</test>

<test>
<rxml><emit source="sql" db="local" query="SELECT id FROM __test"
 rowinfo="var.row">&_.id; &_.a; &var.row;:</emit>&var.row;</rxml>
<result>1  3:2  3:3  3:3</result>
</test>

<test>
<rxml><emit source="sql" db="local" query="SELECT id FROM __test"
 maxrows="1" remainderinfo="var.rem">&_.id;</emit>:&var.rem;</rxml>
<result>1:2</result>
</test>

<test>
<rxml><sqltable db="local" query="SELECT * FROM __test"/></rxml>
<result><table><tr><th>id</th><th>a</th></tr>
<tr><td>1</td><td>hej</td></tr>
<tr><td>2</td><td>hopp</td></tr>
<tr><td>3</td><td></td></tr>
</table></result>
</test>

<test>
<rxml><sqltable db="local" query="SELECT * FROM __test" ascii="1" rowinfo="var.r"/>&var.r;</rxml>
<result>1	hej
2	hopp
3	
3</result>
</test>

<test>
<rxml><sqltable db="local" query="SELECT * FROM __test" ascii="1" nullvalue="x"/></rxml>
<result>1	hej
2	hopp
3	x
</result>
</test>

<test>
  <rxml type="string">
    <emit source="sql" db="local" query="SELECT * FROM __test" sort="a">
      &_.id;,&_.a;;
    </emit>
  </rxml>
  <result>3,;1,hej;2,hopp;</result>
</test>

<test>
  <rxml type="string">
    <emit source="sql" db="local" query="SELECT * FROM __test" sort="*a">
      &_.id;,&_.a;;
    </emit>
  </rxml>
  <result>3,;1,hej;2,hopp;</result>
</test>

<test>
  <rxml type="string">
    <emit source="sql" db="local" query="SELECT * FROM __test" sort="^a">
      &_.id;,&_.a;;
    </emit>
  </rxml>
  <result>3,;1,hej;2,hopp;</result>
</test>

<test>
<rxml><sqlquery db="local" query="DROP TABLE __test"/>&page.last-true;</rxml>
<result>1</result>
</test>
