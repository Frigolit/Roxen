<mail-verify-login>

<if variable=send>
  <formoutput>
   <redirect to="send.html?mail_id=#mail_id#">
  </formoutput>
</if>

<if variable=cancel>
  <unset variable=cancel>
  <set variable=mailbox_id eval='<mail-mailboxid mailbox=drafts>'>
  <formoutput>
   <redirect to="./?mailbox_id=#mailbox_id#&listall=1">
  </formoutput>
</if>

<if variable=abort>
  <unset variable=abort>
  <formoutput><delete-mail mail=#mail_id#></formoutput>
  <redirect to="./">
</if>
<else>

<template mail.tmpl>
<title>Mail composer for <mail-userinfo real> &lt;<mail-userinfo email>&gt;</title>
<headline>Compose a new message</headline>
<content>
  <use file=macros>
  <expire-time now>

  <set variable="gtextid&selected;" 
       eval="<gtext-id talign=center xspacing=20 yspacing=8 
                       bg=#fea fg=black scale=0.3 notrans 
                       bevel=3 quant=14>$">

  <set variable="gtextidselected" 
       eval="<gtext-id talign=center xspacing=20 yspacing=8 
                       bg=#aef fg=black scale=0.3 notrans 
                       bevel=3 quant=14>$">


<if variable=quick_to>
  <if not variable="quick_to is other">
    <cset variable=to preparse><insert variable=quick_to></cset>
  </if>
</if>

<if variable=mail_id>
 <-compose-mail> 
 <mail-show-attachments>
 <-decompose-mail>
</if>
<else>
  <cset variable=mail_id preparse><new-outgoing-mail></cset>
</else>

<table>
<formoutput>

<form enctype=multipart/form-data method=post action=edit.html>
<input type=hidden name=mail_id value=#mail_id#>
  <tr><td align=right><b>To:</td><td>
<input size=64 name=to value='#to:quote=html#'></td></tr>
  <tr><td align=right><b>Subject:</td><td><input size=64 name=subject value='#subject:quote=html#'></tr>
  <tr><td align=right><b>Cc:</td><td><input size=64 name=cc value='#cc:quote=html#'></tr>
  <tr><td align=right><b>Bcc:</td><td><input size=64 name=bcc value='#bcc:quote=html#'></tr>
  <tr><td align=right valign=top><b>Attachments:</td><td><mail-show-attachments show></td></tr>
</table>
<textarea cols=80 rows=22 wrap=hard name=body>#body:quote=html#</textarea>
<tt>
<br>
<input type=submit name=send value="   Send   ">
<input type=submit name=cancel value=" Save Draft">
<input type=submit name=abort value=" Cancel "></tt>
</form>
</formoutput>
</content>
</template>
</mail-verify-login>
</else>